<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/"><channel><title>Macos on DLog</title><link>https://downmars.github.io/zh/tags/macos/</link><description>Recent content in Macos on DLog</description><generator>Hugo -- 0.145.0</generator><language>zh-CN</language><lastBuildDate>Sun, 23 Mar 2025 14:32:53 +0800</lastBuildDate><atom:link href="https://downmars.github.io/zh/tags/macos/index.xml" rel="self" type="application/rss+xml"/><item><title>Macos plist 配置</title><link>https://downmars.github.io/zh/posts/2025_03_23-macos_plist/</link><pubDate>Sun, 23 Mar 2025 14:32:53 +0800</pubDate><guid>https://downmars.github.io/zh/posts/2025_03_23-macos_plist/</guid><description>&lt;h2 id="前言">前言&lt;/h2>
&lt;p>在 macOS 系统中，launchd 是管理系统和用户后台任务（即守护进程 Daemons 与代理进程 Agents）的核心机制。想要在 macOS 上创建或管理定时任务、服务程序或后台脚本，理解 launchd 和其对应的 .plist 配置文件是必不可少的。
&lt;span class="sidenote-number">&lt;small class="sidenote">本文内容参考于&lt;a href="https://developer.apple.com/library/archive/documentation/MacOSX/Conceptual/BPSystemStartup/Chapters/CreatingLaunchdJobs.html"
target="_blank" rel="noopener"
class="custom-link">
Creating Launch Daemons and Agents&lt;span class="external-link">↗&lt;/span>&lt;/a>&lt;/small>&lt;/span>
&lt;/p></description><content:encoded><![CDATA[<h2 id="前言">前言</h2>
<p>在 macOS 系统中，launchd 是管理系统和用户后台任务（即守护进程 Daemons 与代理进程 Agents）的核心机制。想要在 macOS 上创建或管理定时任务、服务程序或后台脚本，理解 launchd 和其对应的 .plist 配置文件是必不可少的。
<span class="sidenote-number"><small class="sidenote">本文内容参考于<a href="https://developer.apple.com/library/archive/documentation/MacOSX/Conceptual/BPSystemStartup/Chapters/CreatingLaunchdJobs.html"
   
    
       target="_blank" rel="noopener" 
   
   class="custom-link">  
   Creating Launch Daemons and Agents<span class="external-link">↗</span></a></small></span>

</p>
<h2 id="为什呢使用launchd">为什呢使用launchd</h2>
<p>相比传统方式（如 cron、inetd），launchd 提供了更现代和统一的方式来启动和管理进程，优势包括：</p>
<ul>
<li>支持按需启动（On-Demand）：节省系统资源；</li>
<li>无需处理依赖顺序：launchd 会自动协调启动顺序；</li>
<li>统一配置入口：通过标准化的 .plist 文件配置任务；</li>
<li>简化权限处理：系统层任务由 launchd（以 root 身份）启动后传递资源给子进程；</li>
<li>支持多种触发方式：时间、文件变动、目录状态、Socket 等。</li>
</ul>
<h2 id="launchdaemons-vs-launchagents">LaunchDaemons vs LaunchAgents</h2>
<ul>
<li>LaunchDaemons：系统级守护进程（/Library/System/LaunchDaemons），在无用户登录时也能运行。</li>
<li>LaunchAgents：用户级代理进程（/Library/LaunchAgents 或 ~/Library/LaunchAgents），需要用户登录后才会运行。</li>
</ul>
<h2 id="plist-文件结构与关键字段">plist 文件结构与关键字段</h2>
<p>.plist 文件是以 XML 格式编写的，以下是几个关键字段：</p>
<table>
  <thead>
      <tr>
          <th>Key</th>
          <th>作用说明</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>Label</code></td>
          <td>唯一标识任务（必须）</td>
      </tr>
      <tr>
          <td><code>ProgramArguments</code></td>
          <td>启动命令和参数（必须）</td>
      </tr>
      <tr>
          <td><code>KeepAlive</code></td>
          <td>是否持续运行（默认为 false）</td>
      </tr>
      <tr>
          <td><code>StartInterval</code></td>
          <td>每隔多少秒执行一次任务</td>
      </tr>
      <tr>
          <td><code>StartCalendarInterval</code></td>
          <td>类似 cron 的定时机制（如每月 7 日 13:45）</td>
      </tr>
      <tr>
          <td><code>WatchPaths</code></td>
          <td>监听指定路径的变动</td>
      </tr>
      <tr>
          <td><code>QueueDirectories</code></td>
          <td>监听目录非空触发运行</td>
      </tr>
      <tr>
          <td><code>StandardOutPath</code> / <code>StandardErrorPath</code></td>
          <td>输出日志路径</td>
      </tr>
      <tr>
          <td><code>Sockets</code></td>
          <td>声明监听的端口（支持 TCP/UDP）</td>
      </tr>
      <tr>
          <td><code>inetdCompatibility</code></td>
          <td>模拟旧的 inetd 行为</td>
      </tr>
  </tbody>
</table>
<h3 id="hello-world">Hello World</h3>















  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  









<p><details class="custom-collapse" open>
  <summary markdown="span">
    <span>/Library/LaunchDaemons/com.example.hello.plist</span>
    <span class="line-count">13 lines</span>
  </summary>
  <div class="content">
    <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>&lt;plist version=&#34;1.0&#34;&gt;
</span></span><span style="display:flex;"><span>&lt;dict&gt;
</span></span><span style="display:flex;"><span>    &lt;key&gt;Label&lt;/key&gt;
</span></span><span style="display:flex;"><span>    &lt;string&gt;com.example.hello&lt;/string&gt;
</span></span><span style="display:flex;"><span>    &lt;key&gt;ProgramArguments&lt;/key&gt;
</span></span><span style="display:flex;"><span>    &lt;array&gt;
</span></span><span style="display:flex;"><span>        &lt;string&gt;hello&lt;/string&gt;
</span></span><span style="display:flex;"><span>        &lt;string&gt;world&lt;/string&gt;
</span></span><span style="display:flex;"><span>    &lt;/array&gt;
</span></span><span style="display:flex;"><span>    &lt;key&gt;KeepAlive&lt;/key&gt;
</span></span><span style="display:flex;"><span>    &lt;true/&gt;
</span></span><span style="display:flex;"><span>&lt;/dict&gt;
</span></span><span style="display:flex;"><span>&lt;/plist&gt;
</span></span></code></pre></div>
  </div>
</details></p>

<h3 id="每-5-分钟执行一次">每 5 分钟执行一次</h3>















  
    
  

  
    
  

  
    
  









<p><details class="custom-collapse" open>
  <summary markdown="span">
    <span>/Library/LaunchDaemons/com.example.hello.plist</span>
    <span class="line-count">2 lines</span>
  </summary>
  <div class="content">
    <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>&lt;key&gt;StartInterval&lt;/key&gt;
</span></span><span style="display:flex;"><span>&lt;integer&gt;300&lt;/integer&gt;
</span></span></code></pre></div>
  </div>
</details></p>

<h3 id="监听某文件变化">监听某文件变化</h3>















  
    
  

  
    
  

  
    
  

  
    
  

  
    
  









<p><details class="custom-collapse" open>
  <summary markdown="span">
    <span>/Library/LaunchDaemons/com.example.hello.plist</span>
    <span class="line-count">4 lines</span>
  </summary>
  <div class="content">
    <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>&lt;key&gt;WatchPaths&lt;/key&gt;
</span></span><span style="display:flex;"><span>&lt;array&gt;
</span></span><span style="display:flex;"><span>    &lt;string&gt;/etc/hostconfig&lt;/string&gt;
</span></span><span style="display:flex;"><span>&lt;/array&gt;
</span></span></code></pre></div>
  </div>
</details></p>

<h2 id="如何加载与管理plist">如何加载与管理plist</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#6272a4"># 加载任务</span>
</span></span><span style="display:flex;"><span>sudo launchctl load /Library/LaunchDaemons/com.example.hello.plist
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 卸载任务</span>
</span></span><span style="display:flex;"><span>sudo launchctl unload /Library/LaunchDaemons/com.example.hello.plist
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 查看任务状态</span>
</span></span><span style="display:flex;"><span>launchctl list | grep com.example.hello
</span></span></code></pre></div>]]></content:encoded></item></channel></rss>