---
title: "Hugo博客搭建_配置 🚀"
date: 2025-01-20T20:42:23+08:00
lastmod: 2025-01-20T20:42:23+08:00
draft: false

# 作者
author: "Downmars"

# 分类和标签
tags: ["Hugo", "configuration"]
categories: [""]

# 描述
description: "" # SEO 搜索优化
summary: ""    # 列表页展示的简短描述

# 可选：权重（用于置顶文章）
weight: null

license: "CC-BY-NC-4.0"  # 对应 data/licenses.yml 中的 keys

# 可选：封面图片
cover:
    image: "images/plsn_1.jpg"
    alt: "Sonny_boy"
    caption: ""
---

# 前言
在上一篇文章“[Hugo博客搭建_基础 😊](../hugo_build_1)”中，我们讲解了如何搭建一个Hugo博客，这一篇文章将会讲解如何配置Hugo博客。

# 基础配置文件
我们曾经在`hugo.yaml`中配置本博客的一些功能，我们将会在这一部分补充和讨论剩余的配置：
{{< collapse summary="hugo.yaml" >}}
```yaml
# Basic Configuration (基础配置)
baseURL: ""               # Site URL (网站 URL)(e.g. https://downmars.github.io/)
title: ""                # Site title (网站标题)(e.g. DLog)
theme: ""                # Theme name (主题名称)(e.g. PaperMod, in /themes/)

# Feature Toggles (功能开关)
enableEmoji: true         # Enable emoji support (启用表情支持)(e.g. https://gohugo.io/quick-reference/emojis/#smileys--emotion)
enableRobotsTXT: true     # Enable search engine support (启用搜索引擎支持)
hasCJKLanguage: true      # Enable CJK language support (启用中日韩语言支持)
buildDrafts: false        # Build draft posts (是否构建草稿文章)
buildFuture: false        # Build future posts (是否构建未来日期文章) 
buildExpired: false       # Build expired posts (是否构建过期文章)

# Parameters Configuration (参数配置)
params:
  # Theme Settings (主题设置)
  defaultTheme: dark      # Default theme mode (默认主题模式)
  disableThemeToggle: false # Allow theme switching (允许主题切换)
 
  # Display Features (显示功能)
  ShowShareButtons: true    # Show social share buttons (显示分享按钮)
  ShowCodeCopyButtons: true # Show code copy buttons (显示代码复制按钮)
  ShowReadingTime: true    # Show reading time estimate (显示阅读时间)
  ShowWordCount: true      # Show word count (显示字数统计)
  ShowPostNavLinks: true   # Show post navigation (显示文章导航)
  ShowBreadCrumbs: true    # Show breadcrumb navigation (显示面包屑导航)
  ShowToc: true           # Show table of contents (显示目录)
  TocOpen: true          # TOC expanded by default (目录默认展开)
  
  math: true

  fancybox: true # Display Images (显示图片)

 # Comment System (评论系统)
  comments: true          # Enable comments (启用评论)
  giscus:                # Giscus configuration (Giscus 配置)
    repo: ""
    repoId: ""
    category: ""
    categoryId: ""
    mapping: "pathname"
    strict: "0"
    reactionsEnabled: "1"
    emitMetadata: "0"
    inputPosition: "bottom"
    lightTheme: "light"
    darkTheme: "dark"
    lang: "zh-CN"
    crossorigin: "anonymous"

  fuseOpts: # refer: https://sonnycalcr.github.io/posts/build-a-blog-using-hugo-papermod-github-pages/#%e9%85%8d%e7%bd%ae%e6%90%9c%e7%b4%a2
    isCaseSensitive: false # 是否大小写敏感
    shouldSort: true # 是否排序
    location: 0
    distance: 1000
    threshold: 0.4
    minMatchCharLength: 0
    # limit: 10 # refer: https://www.fusejs.io/api/methods.html#search
    keys: ["title", "permalink", "summary", "content"]
    includeMatches: true

  # Assets Files (资源文件)
  assets:
    favicon: ""          # Site favicon (网站图标)
    favicon16x16: ""     # Small favicon (小图标)
    favicon32x32: ""     # Medium favicon (中图标)
    apple_touch_icon: "" # iOS icon (iOS 图标)
    safari_pinned_tab: "" # Safari icon (Safari 图标)

# Multilingual Support (多语言支持)
languages:
  zh:
    languageCode: "zh-CN"
    languageName: "简体中文"
    contentDir: "content/zh"
    weight: 1
    menu:
      main:
        - identifier: posts
          name: "Posts"
          url: "/posts/"
          weight: 1

# Output Settings (输出设置)
outputs:
  home:
    - HTML
    - RSS
    - JSON               # Required for search (搜索功能需要)

# Rendering Configuration (渲染配置)
markup:
  goldmark:
    renderer:
      unsafe: true      # Allow HTML in markdown (允许 Markdown 中的 HTML)
  highlight:
    codeFences: true    # Enable code highlighting (启用代码高亮)
    guessSyntax: true   # Guess code language (猜测代码语言)
    lineNos: true      # Show line numbers (显示行号)
    style: dracula     # Code highlight theme (代码高亮主题)
    lineNumbersInTable: true 
```
{{< /collapse >}}


## 功能开关

### 表情支持
通过启用此功能，我们能够从 Github Emoji API 和 Unicode 完整表情符号列表中读取数据。博主显出极高兴的样子，将两个指头的敲着键盘，点头说，“对呀对呀！……表情有两样写法，你知道么？”

Shortcode: `:drooling_face:`:drooling_face:

Unicode: `&#x1F924`&#x1F924;

关于对应的表情和文档可以查询：

- [shortcode](https://gohugo.io/quick-reference/emojis/#smileys--emotion)
- [Unicode](https://www.unicode.org/emoji/charts/emoji-list.html)

## 参数配置

### 图片放大

> 参考于：[Hugo PaperMod 主题精装修](https://yunpengtai.top/posts/hugo-journey/#%e5%9b%be%e7%89%87%e7%82%b9%e5%87%bb%e6%94%be%e5%a4%a7)

{{< figure src="/images/plsn_3.jpg" alt="A beautiful landscape" title="Sonny_boy" caption="This is a caption for the image" align="center" width=600px height=300px >}}

我们使用引入[fancybox](http://fancybox.net/)来实现：

在`layouts/shortcodes/figure.html`中加入：
```html 
<script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>

<a data-fancybox="gallery" href="{{ .Get "src" }}">
<figure{{ if or (.Get "class") (eq (.Get "align") "center") }} class="
           {{- if eq (.Get "align") "center" }}align-center {{ end }}
           {{- with .Get "class" }}{{ . }}{{- end }}"
{{- end -}}>
    {{- if .Get "link" -}}
        <a href="{{ .Get "link" }}"{{ with .Get "target" }} target="{{ . }}"{{ end }}{{ with .Get "rel" }} rel="{{ . }}"{{ end }}>
    {{- end }}
    <img loading="lazy" src="{{ .Get "src" }}{{- if eq (.Get "align") "center" }}#center{{- end }}"
         {{- if or (.Get "alt") (.Get "caption") }}
         alt="{{ with .Get "alt" }}{{ . }}{{ else }}{{ .Get "caption" | markdownify| plainify }}{{ end }}"
         {{- end -}}
         {{- with .Get "width" }} width="{{ . }}"{{ end -}}
         {{- with .Get "height" }} height="{{ . }}"{{ end -}}
    /> <!-- Closing img tag -->
    {{- if .Get "link" }}</a>{{ end -}}
    {{- if or (or (.Get "title") (.Get "caption")) (.Get "attr") -}}
        <figcaption>
            {{ with (.Get "title") -}}
                {{ . }}
            {{- end -}}
            {{- if or (.Get "caption") (.Get "attr") -}}<p>
                {{- .Get "caption" | markdownify -}}
                {{- with .Get "attrlink" }}
                    <a href="{{ . }}">
                {{- end -}}
                {{- .Get "attr" | markdownify -}}
                {{- if .Get "attrlink" }}</a>{{ end }}</p>
            {{- end }}
        </figcaption>
    {{- end }}
</figure>
</a>

```

### 数学公示

> 参考于：[Hugo博客添加LaTeX语法支持](https://www.shaohanyun.top/posts/env/hugo_mathjax/#mathjax%e4%b8%8emarkdown%e7%9a%84%e8%9e%8d%e5%90%88)、[Hugo PaperMod 主题精装修](https://yunpengtai.top/posts/hugo-journey/#%e6%95%b0%e5%ad%a6%e5%85%ac%e5%bc%8f)、[MathJax 与 Markdown 的究极融合](https://yihui.org/cn/2017/04/mathjax-markdown/)

上述博客中提到了相同的问题即 ”对于mathjax与markdown格式中，hugo在渲染的过程中将`_`渲染为了`<em>`标签，导致mathjax在渲染的时候找不到原来正确的公示“。

首先，我们在`hugo.yaml`中添加：

```yaml
params:
  math: true
```

接着，我们在`layouts/partials/mathjax.html`中添加：
```html 
<script type="text/javascript"
        async
        src="https://cdn.bootcss.com/mathjax/2.7.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$'], ['\[\[','\]\]']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
});

MathJax.Hub.Queue(function() {
    // Fix <code> tags after MathJax finishes running. This is a
    // hack to overcome a shortcoming of Markdown. Discussion at
    // https://github.com/mojombo/jekyll/issues/199
    var all = MathJax.Hub.getAllJax(), i;
    for(i = 0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
</script>

```
接着，在`layouts/partials/extend_footer.html`中添加：

```html 
<script>
  (function () {
    var i, text, code, codes = document.getElementsByTagName("code");
    for (i = 0; i < codes.length; ) {
      code = codes[i];
      if (code.parentNode.tagName !== "PRE" && code.childElementCount === 0) {
        text = code.textContent;
        if (/^\$[^$]/.test(text) && /[^$]\$$/.test(text)) {
          text = text.replace(/^\$/, "\\(").replace(/\$$/, "\\)");
          code.textContent = text;
        }
        if (
          /^\\\((.|\s)+\\\)$/.test(text) ||
          /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$(.|\s)+\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)
        ) {
          code.outerHTML = code.innerHTML; // remove <code></code>
          continue;
        }
      }
      i++;
    }
  })();
</script>

```
最后，在`layouts/partials/extend_head.html`中添加来判断`hugo.yaml`中是否启用来决定是否渲染：
```html 
{{ if or .Params.math .Site.Params.math }}
{{- partial "mathjax.html" .}}
{{ end }}

```
本处引用的方法通过将带有公式部分使用代码block装饰起来，避免内容被修改，再将代码block去除，完整将其送给渲染工具。

没做处理之前，以下代码无法渲染：

`$$
\frac{\partial E(\boldsymbol{w})}{\partial z_j} = \sum\limits_{k}\frac{\partial E(\boldsymbol{w})}{\partial y_{k}}\frac{\partial y_k}{\partial z_{j}}= \sum\limits_{k} (y_{k}- \hat{y}_{k}) w_{kj}^{(2)} \tag{5.11}
$$
`


> 现有几个问题待解决：1、白色黑色主题字体颜色未翻转；2、字体大小没有自动渲染正确，在中间的一个步骤，使能够正常匹配主题的颜色和字体大小，但是完全渲染过后就会出现刚才提及的问题，可能的解决方法参考于[解决 mathjax 数学公式渲染的字体大小问题](https://quanquan.space/viewtopic.php?t=629)

### 目录配置

对于自带的目录，只显示在文章最上面，既不能让读者随时掌握到阅读进度，也不够优雅，所以我在参考了[在PaperMod中引入侧边目录和阅读进度显示](https://www.zhouxin.space/logs/introduce-side-toc-and-reading-percentage-to-papermod/)基础上做了一些改动
- 自动编号
- 当前浏览章节下划线显示
创建 `layout/partials/toc.html` ,
```html
<!-- 目录侧边栏 -->
{{- $headers := findRE "<h[1-6].*?>(.|\n])+?</h[1-6]>" .Content -}}
{{- $has_headers := ge (len $headers) 1 -}}
{{- if $has_headers -}}
<aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details {{if (.Param "TocOpen") }} open{{ end }}>
            <summary accesskey="c" title="(Alt + C)">
                <span class="details">{{- i18n "toc" | default "Table of Contents" }}</span>
            </summary>

            <div class="inner">
                {{- $largest := 6 -}}
                {{- range $headers -}}
                {{- $headerLevel := index (findRE "[1-6]" . 1) 0 -}}
                {{- $headerLevel := len (seq $headerLevel) -}}
                {{- if lt $headerLevel $largest -}}
                {{- $largest = $headerLevel -}}
                {{- end -}}
                {{- end -}}

                {{- $firstHeaderLevel := len (seq (index (findRE "[1-6]" (index $headers 0) 1) 0)) -}}

                {{- $.Scratch.Set "bareul" slice -}}
                <ul>
                    {{- range seq (sub $firstHeaderLevel $largest) -}}
                    <ul>
                        {{- $.Scratch.Add "bareul" (sub (add $largest .) 1) -}}
                        {{- end -}}
                        {{- range $i, $header := $headers -}}
                        {{- $headerLevel := index (findRE "[1-6]" . 1) 0 -}}
                        {{- $headerLevel := len (seq $headerLevel) -}}

                        {{/* get id="xyz" */}}
                        {{- $id := index (findRE "(id=\"(.*?)\")" $header 9) 0 }}

                        {{- /* strip id="" to leave xyz, no way to get regex capturing groups in hugo */ -}}
                        {{- $cleanedID := replace (replace $id "id=\"" "") "\"" "" }}
                        {{- $header := replaceRE "<h[1-6].*?>((.|\n])+?)</h[1-6]>" "$1" $header -}}

                        {{- if ne $i 0 -}}
                        {{- $prevHeaderLevel := index (findRE "[1-6]" (index $headers (sub $i 1)) 1) 0 -}}
                        {{- $prevHeaderLevel := len (seq $prevHeaderLevel) -}}
                        {{- if gt $headerLevel $prevHeaderLevel -}}
                        {{- range seq $prevHeaderLevel (sub $headerLevel 1) -}}
                        <ul>
                            {{/* the first should not be recorded */}}
                            {{- if ne $prevHeaderLevel . -}}
                            {{- $.Scratch.Add "bareul" . -}}
                            {{- end -}}
                            {{- end -}}
                            {{- else -}}
                            </li>
                            {{- if lt $headerLevel $prevHeaderLevel -}}
                            {{- range seq (sub $prevHeaderLevel 1) -1 $headerLevel -}}
                            {{- if in ($.Scratch.Get "bareul") . -}}
                        </ul>
                        {{/* manually do pop item */}}
                        {{- $tmp := $.Scratch.Get "bareul" -}}
                        {{- $.Scratch.Delete "bareul" -}}
                        {{- $.Scratch.Set "bareul" slice}}
                        {{- range seq (sub (len $tmp) 1) -}}
                        {{- $.Scratch.Add "bareul" (index $tmp (sub . 1)) -}}
                        {{- end -}}
                        {{- else -}}
                    </ul>
                    </li>
                    {{- end -}}
                    {{- end -}}
                    {{- end -}}
                    {{- end }}
                    <li>
                        <a href="#{{- $cleanedID -}}" aria-label="{{- $header | plainify -}}">{{- $header | safeHTML -}}</a>
                        {{- else }}
                    <li>
                        <a href="#{{- $cleanedID -}}" aria-label="{{- $header | plainify -}}">{{- $header | safeHTML -}}</a>
                        {{- end -}}
                        {{- end -}}
                        {{- $firstHeaderLevel := $largest }}
                        {{- $lastHeaderLevel := len (seq (index (findRE "[1-6]" (index $headers (sub (len $headers) 1)) 1) 0)) }}
                    </li>
                    {{- range seq (sub $lastHeaderLevel $firstHeaderLevel) -}}
                    {{- if in ($.Scratch.Get "bareul") (add . $firstHeaderLevel) }}
                </ul>
                {{- else }}
                </ul>
                </li>
                {{- end -}}
                {{- end }}
                </ul>
            </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    let headerCounters = {};

    // 重置所有计数器
    function resetHeaderCounters() {
        headerCounters = {};
    }

    // 获取标题的自动编号
    function getHeaderNumber(element, headerLevel) {
        // 获取之前的所有标题元素
        let prevElements = Array.from(document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]'));
        let currentIndex = prevElements.indexOf(element);
        let numbers = [];
        
        // 重置当前级别之后的计数器
        Object.keys(headerCounters).forEach(level => {
            if (parseInt(level) > headerLevel) {
                delete headerCounters[headerLevel];
            }
        });
        
        // 遍历到当前元素为止的所有标题
        for (let i = 0; i <= currentIndex; i++) {
            let currentElement = prevElements[i];
            let currentLevel = parseInt(currentElement.tagName.substring(1));
            
            if (currentLevel <= headerLevel) {
                // 更新计数器
                if (!headerCounters[currentLevel]) {
                    headerCounters[currentLevel] = 1;
                } else if (currentElement === element) {
                    headerCounters[currentLevel]++;
                }
                
                // 构建当前层级的编号
                if (currentElement === element) {
                    for (let level = 1; level <= currentLevel; level++) {
                        if (headerCounters[level]) {
                            numbers.push(headerCounters[level]);
                        }
                    }
                }
            }
        }
        
        return numbers.join('.');
    }

    // 更新目录项的显示
    function updateTocDisplay(element, tocLink) {
        const headerLevel = parseInt(element.tagName.substring(1));
        const currentNumber = getHeaderNumber(element, headerLevel);
        
        // 移除之前可能存在的编号
        let linkText = tocLink.textContent;
        linkText = linkText.replace(/^\d+(\.\d+)*\s+/, '');
        
        // 添加新的编号
        tocLink.textContent = `${currentNumber} ${linkText}`;
    }

    // 获取元素的顶部偏移
    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;   
    }

    // 检查TOC位置
    function checkTocPosition() {
        const width = document.body.scrollWidth;
        const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
        const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
        const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);
    
        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }

    // 初始化时的处理
    document.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();
    
        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
        if (elements.length > 0) {
            // 设置第一个标题为活动状态
            activeElement = elements[0];
            const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
            document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
        }
    
        // 初始化所有标题的编号
        if (elements && elements.length > 0) {
            elements.forEach(element => {
                const id = encodeURI(element.getAttribute('id')).toLowerCase();
                const tocLink = document.querySelector(`.inner ul li a[href="#${id}"]`);
                
                if (tocLink) {
                    updateTocDisplay(element, tocLink);
                }
            });
        }

        // 添加返回顶部链接的事件监听
        const topLink = document.getElementById('top-link');
        if (topLink) {
            topLink.addEventListener('click', (event) => {
                event.preventDefault();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
        }
    }, false);

    // 窗口大小改变时的处理
    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);

    // 滚动时的处理
    window.addEventListener('scroll', () => {
        const scrollPosition = window.pageYOffset || document.documentElement.scrollTop;

        if (scrollPosition === 0) {
            return;
        }

        if (elements && elements.length > 0) {
            // 重置计数器
            resetHeaderCounters();
            
            // 查找当前可见的标题
            activeElement = Array.from(elements).find((element) => {
                if ((getOffsetTop(element) - scrollPosition) > 0 && 
                    (getOffsetTop(element) - scrollPosition) < window.innerHeight / 2) {
                    return element;
                }
            }) || activeElement;

            // 更新所有目录项的显示
            elements.forEach(element => {
                const id = encodeURI(element.getAttribute('id')).toLowerCase();
                const tocLink = document.querySelector(`.inner ul li a[href="#${id}"]`);
                
                if (tocLink) {
                    updateTocDisplay(element, tocLink);
                    
                    if (element === activeElement) {
                        tocLink.classList.add('active');
                        tocLink.style.textDecoration = "underline";
                        
                        // 确保当前激活的标题在目录中可见
                        const tocContainer = document.querySelector('.toc .inner');
                        const linkOffsetTop = tocLink.offsetTop;
                        const containerHeight = tocContainer.clientHeight;
                        const linkHeight = tocLink.clientHeight;
    
                        // 计算滚动位置，将当前目录项居中显示
                        const scrollPosition = linkOffsetTop - (containerHeight / 2) + (linkHeight / 2);
                        tocContainer.scrollTo({ top: scrollPosition, behavior: 'smooth' });
                    } else {
                        tocLink.classList.remove('active');
                        tocLink.style.textDecoration = "none";
                    }
                }
            });
        }
    }, false);
</script>
{{- end }}
```

创建`assets/css/extended/toc.css`，根据阅读内容滚动并加粗相应标题就由其实现。
```css 
/*目录侧边栏*/
:root {
    --nav-width: 1380px;
    --article-width: 650px;
    --toc-width: 300px;
}

.toc {
    margin: 0 2px 40px 2px;
    border: 1px solid var(--border);
    background: var(--entry);
    border-radius: var(--radius);
    padding: 0.4em;
}

.toc-container.wide {
    position: absolute;
    height: 100%;
    border-right: 1px solid var(--border);
    left: calc((var(--toc-width) + var(--gap)) * -1);
    top: calc(var(--gap) * 2);
    width: var(--toc-width);
}

.wide .toc {
    position: sticky;
    top: var(--gap);
    border: unset;
    background: unset;
    border-radius: unset;
    width: 100%;
    margin: 0 2px 40px 2px;
}

.toc details summary {
    cursor: zoom-in;
    margin-inline-start: 20px;
    padding: 12px 0;
}

.toc details[open] summary {
    font-weight: 500;
}

.toc-container.wide .toc .inner {
    margin: 0;
}

.active {
    font-size: 110%;
    font-weight: 600;
}

.toc ul {
    list-style-type: circle;
}

.toc .inner {
    margin: 0 0 0 20px;
    padding: 0px 15px 15px 20px;
    font-size: 16px;

    /*目录显示高度*/
    max-height: 83vh;
    overflow-y: auto;
}

.toc .inner::-webkit-scrollbar-thumb {  /*滚动条*/
    background: var(--border);
    border: 7px solid var(--theme);
    border-radius: var(--radius);
}

.toc li ul {
    margin-inline-start: calc(var(--gap) * 0.5);
    list-style-type: none;
}

.toc li {
    list-style: none;
    font-size: 0.95rem;
    padding-bottom: 5px;
}

.toc li a:hover {
    color: var(--secondary);
}
/*目录侧边栏*/
```

### 评论支持
对于评论支持，我选择了[Giscus](https://giscus.app/zh-CN)。由于本博客也是部署在Github上，在减少额外操作的同时 `Giscus` 也显得足够的优雅简单。

此处操作参考了[Hugo 博客引入 Giscus 评论系统](https://www.lixueduan.com/posts/blog/02-add-giscus-comment/)。

1. [Giscus](https://giscus.app/zh-CN) -> 进入配置栏
2. 配置 -> 仓库 -> 填入仓库名，如[Downmars/Downmars.github.io](https://github.com/Downmars/Downmars.github.io) -> 若不满足条件，分别查看：对应仓库是否公开、giscus app 是否安装、 Discussions 功能在对应仓库是否启用
3. 配置 -> Discussions 分类 -> 选中Announcements
4. 配置 -> 启用giscus -> 复制相应字段到配置中

同时需要创建 `layouts/partials/comments.html`，此处参考了[Hugo + PaperMod + Github Pages 搭建一个完善的个人博客(以 Windows11 为例)](https://sonnycalcr.github.io/posts/build-a-blog-using-hugo-papermod-github-pages/)。
```html
{{- /* Comments area start */ -}}
{{- /* to add comments read => https://gohugo.io/content-management/comments/ */ -}}
<div id="tw-comment"></div>
<script>
    // 默认是暗色，根目录下的配置中的主题默认也是暗色
    const getStoredTheme = () => localStorage.getItem("pref-theme") === "light" ? "{{ .Site.Params.giscus.lightTheme }}" : "{{ .Site.Params.giscus.darkTheme }}";
    const setGiscusTheme = () => {
        const sendMessage = (message) => {
            const iframe = document.querySelector('iframe.giscus-frame');
            if (iframe) {
                iframe.contentWindow.postMessage({giscus: message}, 'https://giscus.app');
            }
        }
        sendMessage({setConfig: {theme: getStoredTheme()}})
    }

    document.addEventListener("DOMContentLoaded", () => {
        const giscusAttributes = {
            "src": "https://giscus.app/client.js",
            "data-repo": "{{ .Site.Params.giscus.repo }}",
            "data-repo-id": "{{ .Site.Params.giscus.repoId }}",
            "data-category": "{{ .Site.Params.giscus.category }}",
            "data-category-id": "{{ .Site.Params.giscus.categoryId }}",
            "data-mapping": "{{ .Site.Params.giscus.mapping }}",
            "data-strict": "{{ .Site.Params.giscus.strict }}",
            "data-reactions-enabled": "{{ .Site.Params.giscus.reactionsEnabled }}",
            "data-emit-metadata": "{{ .Site.Params.giscus.emitMetadata }}",
            "data-input-position": "{{ .Site.Params.giscus.inputPosition }}",
            "data-theme": getStoredTheme(),
            "data-lang": "{{ .Site.Params.giscus.lang }}",
            "data-loading": "lazy",
            "crossorigin": "anonymous",
        };

        // 动态创建 giscus script
        const giscusScript = document.createElement("script");
        Object.entries(giscusAttributes).forEach(
                ([key, value]) => giscusScript.setAttribute(key, value));
        document.querySelector("#tw-comment").appendChild(giscusScript);

        // 页面主题变更后，变更 giscus 主题
        const themeSwitcher = document.querySelector("#theme-toggle");
        if (themeSwitcher) {
            themeSwitcher.addEventListener("click", setGiscusTheme);
        }
        const themeFloatSwitcher = document.querySelector("#theme-toggle-float");
        if (themeFloatSwitcher) {
            themeFloatSwitcher.addEventListener("click", setGiscusTheme);
        }
    });
</script>

{{- /* Comments area end */ -}}
```

### 网站图标

咱们一个自己的博客肯定得需要有自己的一个网站图标，可以将图标放在`/static/images/`，如`favicon: "/images/blog.png"`。我在这里推荐两个网站供大家用来查找符合自己图标。

- [fontawesome](https://fontawesome.com/search)
- [flaticon](https://www.flaticon.com/)
- [icons8](https://icons8.com/)
- [iconfinder](https://www.iconfinder.com/)
- [Noun Project](https://thenounproject.com/)

## 多语言 & 界面布置

这部分参考来自于[Hugo 多语言博客搭建，如何优雅地管理多语言 md 内容-贤民](https://www.xianmin.org/post/2024/hugo-multilingual-blog-structure/)。

我认为对于编写博客的我们来说，以时间的形式来分隔是很好的一种方式来存储以及管理我们的博客，使用统一文件命名规范`YYYYMMDD-title.md`。此外，有兴趣的可以做一下多语言的准备，即使现在没有推出多语言的打算，之后可以集中找个时间来使用`ai`工具来统一做一下。

```bash 
.
├── en
│   ├── archives
│   │   └── archives.md
│   ├── posts
│   │   └── 2025_01_19-hugo_build_1.md
│   └── search
│       └── search.md
└── zh
    ├── archives
    │   └── archives.md
    ├── posts
    │   ├── 2025_01_19-hugo_build_1.md
    │   └── 2025_01_20-hugo_build_2.md
    └── search
        └── search.md

```
可以参考我的示例结构，在这里我将`zh/`和`en/`作为`post/`的直接子目录，这一步需在对应的语言下添加设置对应的文档目录，如`contentDir: "content/zh"`。

我们在此处同时需要设置页面布局，创建`zh/archives/archives.md`和`zh/search/search.md`，
```md 
---
title: "时间轴"
layout: "archives"
summary: archives
---
```

```md 
---
title: "搜索" # in any language you want
layout: "search" # is necessary
summary: "search"
---
```
其中`layout`字段指定了这个页面使用的模板，默认使用的是`themes\<hugo_theme>\layouts\_default\archives.html&search.html`，所以我们使用默认字段`search`和`archives`即可以让归档内容正常显示。

同时，参考[Hugo + PaperMod + Github Pages 搭建一个完善的个人博客(以 Windows11 为例)](https://sonnycalcr.github.io/posts/build-a-blog-using-hugo-papermod-github-pages/#%e9%85%8d%e7%bd%ae%e6%90%9c%e7%b4%a2)搜索需要额外加入如下配置：
```yaml
params:
  # 搜索
  fuseOpts: # 个性化配置 refer: https://sonnycalcr.github.io/posts/build-a-blog-using-hugo-papermod-github-pages/#%e9%85%8d%e7%bd%ae%e6%90%9c%e7%b4%a2
      isCaseSensitive: false # 是否大小写敏感
      shouldSort: true # 是否排序
      location: 0
      distance: 1000
      threshold: 0.4
      minMatchCharLength: 0
      # limit: 10 # refer: https://www.fusejs.io/api/methods.html#search
      keys: ["title", "permalink", "summary", "content"]
      includeMatches: true

# ......

outputs:
  home:
    - HTML
    - RSS
    - JSON               # Required for search (搜索功能需要)
```

接着，我们在配置文件中加入时间轴与搜索的布局即可：
```yaml
# Multilingual Support (多语言支持)
languages:
  zh:
    languageCode: "zh-CN"
    languageName: "简体中文"
    contentDir: "content/zh"
    weight: 1
    menu:
      main:
        - identifier: posts
          name: "Posts"
          url: "/posts/"
          weight: 1
```

## 渲染配置

### 代码配置

~~`PaperMod`主题使用的代码高亮工具为[Chroma](https://github.com/alecthomas/chroma)，可能不太聪明，但是对于我的日常使用暂时没有太大问题。~~ 我在后面换了个代码渲染方式。

`Chroma`自带的配色方案预览：[https://xyproto.github.io/splash/docs/longer/all.html](https://xyproto.github.io/splash/docs/longer/all.html) 

> 参考于：[深入探究 Hugo 代码高亮](https://blog.loikein.one/posts/2023-01-10-deep-dive-into-hugo-syntax-highlight/)、[代码块语法高亮及复制](https://tomo.dev/posts/create-hugo-theme-from-scratch/part-three/#%E4%BB%A3%E7%A0%81%E5%9D%97%E8%AF%AD%E6%B3%95%E9%AB%98%E4%BA%AE%E5%8F%8A%E5%A4%8D%E5%88%B6)

```yaml
markup:
  highlight:
    codeFences: true 
    guessSyntax: true 
    lineNos: true 
    style: dracula 
    lineNumbersInTable: true 
```
我这里参考了[Hugo PaperMod 主题精装修](https://yunpengtai.top/posts/hugo-journey/#%e4%bb%a3%e7%a0%81%e6%b8%b2%e6%9f%93)的代码渲染方式，在其中选择了[ atom-one-dark/light](https://github.com/highlightjs/highlight.js/blob/main/src/styles/atom-one-light.css)与[atom-one-dark.css](https://github.com/highlightjs/highlight.js/blob/main/src/styles/atom-one-dark.css)。

为了覆盖掉原主题对于代码渲染的设置，我们需要创建`assets/css/hljs/an-old-hope.min.css`，并且在其中复制进去黑色主题和白色主题的配置，白色主题直接复制进去皆可，黑色主题需要以以下形式进行限定：
```css 
body.dark {
  .hljs {
    color: #abb2bf;
    background: #282c34;
  }
  ...
}
```
接着，我们需要修改白色与黑色主题的背景色，同时由于我参考的博主使用了Consolas 和霞鹜文楷（注释的中文字体），字体可以从[博主的仓库](https://github.com/sherlcok314159/MyPaperMod/tree/main/static/fonts)中获取。

我们在`assets/css/extended/blank.css`中添加：
```css 
@font-face {
  font-family: "Consolas";
  src: url("/fonts/Consolas.woff2");
}

code {
  font-family: "Consolas", "LXGWWenKaiScreenR";
}

.post-content code {
  margin: auto 4px;
  padding: 4px 6px;
  font-size: 0.8em;
  line-height: 1.5;
  background: var(--code-bg);
}

.post-content pre code {
  display: block;
  margin: auto 0;
  padding: 10px;
  background: var(--hljs-bg) !important;
  color: var(--content);
  border-radius: var(--radius);
  overflow-x: auto;
  word-break: break-all;
  font-family: "Consolas", "LXGWWenKaiScreenR";
  font-size: 15px;
}

```
并且，在`PaperMod`中的颜色变量配置`assets/css/core/theme-vars.css` 中添加配置：
```css 
/* 省略的内容请拷贝原先主题对应的文件 */
:root {
  ...
  --hljs-bg: #f7f7f7;
  --code-bg: rgb(245, 245, 245);
}

.dark {
  ...
  --hljs-bg: rgb(46, 46, 51);
  --code-bg: rgb(55, 56, 62);
}

```

此外，`PaperMod` 默认的代码复制键的在对应语言下是不同的文字表示复制粘贴，我觉的不够优雅，于是打算使用图标来代替。关于复制符号的配置在`layouts/partials/footer.html` 中：
```html 
        copybutton.innerHTML = '{{- i18n "code_copy" | default "copy" }}';

        function copyingDone() {
            copybutton.innerHTML = '{{- i18n "code_copied" | default "copied!" }}';
            setTimeout(() => {
                copybutton.innerHTML = '{{- i18n "code_copy" | default "copy" }}';
            }, 2000);
        }
```
修改为：
```html 
        copybutton.innerHTML = `
            <img src="/images/copy.svg" 
                 alt="复制"
                 class="copy-icon"
                 width="16" 
                 height="16">
        `;

        function copyingDone() {
            copybutton.innerHTML = `
                <img src="/images/check.svg" 
                     alt="已复制"
                     class="copied-icon"
                     width="16" 
                     height="16">
            `;
            setTimeout(() => {
                copybutton.innerHTML = `
                    <img src="/images/copy.svg" 
                         alt="复制"
                         class="copy-icon"
                         width="16" 
                         height="16">
                `;
            }, 2000);
        }
```
我这里在存放的图片位于`static/images/`，大家可以选择自己的路径。由于编译为静态博客之后，`static/images/`变为`public/images/`，同时以`public/`当作根目录，所以我在代码中使用`/images/check.svg&copy.svg`。

接下来，我们配置复制图标样式，在`assets/css/extend.css`中添加以下代码：
```css 
/*copy_button*/
.copy-code {
    background: transparent;
    border: none;
    cursor: pointer;
    padding: 4px;
    position: absolute;
    right: 10px;
    top: -2px;
}

.copy-code img {
    opacity: 0.6;
    transition: opacity 0.3s, filter 0.3s; /* 添加 filter 过渡效果 */
}

.copy-code:hover img {
    opacity: 1;
    filter: invert(100%); /* 颜色翻转效果 */
}
```
我这里使用的是底色为黑色的`svg`图标，所以我这里做了反色处理。

接下来我们配置代码折叠，对于过长的代码段，十分影响阅读者的感受，参考于[Hugo PaperMod 主题精装修](https://yunpengtai.top/posts/hugo-journey/#%e4%bb%a3%e7%a0%81%e6%8a%98%e5%8f%a0) ，我们需要在`layouts/shortcodes/collapse.html`中加入以下内容：
```html 
{{ if .Get "summary" }}
{{ else }}
{{ warnf "missing value for param 'summary': %s" .Position }}
{{ end }}
<p><details {{ if (eq (.Get "openByDefault") true) }} open=true {{ end }}>
  <summary markdown="span">{{ .Get "summary" | markdownify }}</summary>
  {{ .Inner | markdownify }}
</details></p>

```


# 额外配置

## 字体配置

我已经忍这个默认字体很久了，现在我们就在这里干掉他。我们在这里选择的中文是[霞鹜文楷](https://github.com/lxgw/LxgwWenKai?tab=readme-ov-file)，英文是 Apple 的字体 SF Pro Text Regular 来渲染，方法参考于： [Hugo PaperMod 主题精装修](https://yunpengtai.top/posts/hugo-journey/#%e5%ad%97%e4%bd%93)。

在`assets/css/extended/blank.css`中加入：
```css 
@font-face {
  font-family: "LXGWWenKaiScreenR";
  src: url("/fonts/lxgwwenkaiscreen.subset.v1.235.standard.woff2");
}

/* https://www.webfontfree.com/cn/download/SFProText-Regular */
@font-face {
  font-family: "SFProText-Regular";
  src: url("/fonts/SFProText-Regular.woff2");
}

body {
  font-family: "SFProText-Regular", "LXGWWenKaiScreenR";
  font-size: 16px;
  line-height: 1.6;
  word-break: break-word;
  background: var(--theme);
  font-display: swap;
}

```

字体可以从我上面提及博主的[github仓库](https://github.com/sherlcok314159/MyPaperMod/tree/main/static/fonts)处获取。



## 知识共享协议

> 参考于:[Hugo+PaperMod 双语博客搭建 Home-Info+Profile Mode](https://www.yunyitang.me/hugo-papermod-blog/#%E7%9F%A5%E8%AF%86%E5%85%B1%E4%BA%AB%E5%8D%8F%E8%AE%AE)、[Hugo ʕ•ᴥ•ʔ Bear Blog](https://hugo.matrixcore.top/license/)

我们在[Creative Commons许可证](https://chooser-beta.creativecommons.org/)中选择使用的知识共享协议，我这里选择的是`CC-BY-NC-4`协议，并添加一个协议模组来自动呈现：

首先创建文件`data/licenses.html`并添加

```yaml
# data/licenses.yml
CC-BY-NC-4.0:
  name: "CC BY-NC 4.0"
  url: "https://creativecommons.org/licenses/by-nc/4.0/"
  icons: &cc_icons  # 锚点复用图标列表
    - cc.svg
    - by.svg
    - nc.svg

# 其他协议
CC-BY-SA-4.0:
  name: "CC BY-SA 4.0"
  url: "https://creativecommons.org/licenses/by-sa/4.0/"
  icons: *cc_icons  # 复用图标列表
```

其次，创建文件`layouts/partials/license.html`并添加：
```html 
<hr> <!-- 添加分割线 -->
{{ $license := index site.Data.licenses .Params.license }}
{{ if $license }}
<div class="license-declaration" vocab="https://schema.org/" typeof="CreativeWork">
  {{/* 自动检测主题模式 */}}
  {{ $theme := "light" }}
  {{ if or (eq .Site.Params.colorTheme "dark") (in .Site.Params.colorTheme "auto") }}
    {{ $theme = "dark" }}
  {{ end }}
  
  <meta property="name" content="{{ .Title }}">
  <link property="copyrightHolder" href="{{ .Site.BaseURL }}#author" />
  <p>
    <span property="license" content="{{ $license.url }}">本文采用</span>
    <a 
      href="{{ $license.url }}" 
      target="_blank" 
      rel="license noopener noreferrer"
      class="license-badge"
      data-theme="{{ $theme }}"
    >
      {{ $license.name }}
      {{ range $icon := $license.icons }}
        <img 
          src="https://mirrors.creativecommons.org/presskit/icons/{{ $icon }}" 
          alt="{{ $icon | replaceRE `\.svg$` `` | upper }} 图标"
          class="license-icon"
          loading="lazy"
          decoding="async"
        >
      {{ end }}
    </a>
  </p>
</div>
{{ end }}
```

接下来，创建文件`assets/extended/custom.css`并添加：
```css 
/* licenses.css */
.license-badge {
  --bg-light: #f8f9fa;
  --bg-dark: #2b2d32;
  --text-light: #212529;
  --text-dark: #f8f9fa;
  
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 8px 16px;
  border-radius: 6px;
  font-size: 0.9em;
  transition: all 0.3s ease;
  
  /* 默认浅色主题 */
  background: var(--bg-light);
  color: var(--text-light);
  border: 1px solid rgba(0,0,0,0.1);
}

.license-icon {
  height: 24px;
  width: auto;
  transition: filter 0.3s ease;
}

/* 深色主题检测 */
@media (prefers-color-scheme: dark) {
  .license-badge:not([data-theme="light"]) {
    background: var(--bg-dark);
    color: var(--text-dark);
    border-color: rgba(255,255,255,0.1);
    
    & .license-icon {
      filter: invert(1) hue-rotate(180deg); /* 更自然的反色 */
    }
  }
}

/* 强制深色模式 */
.license-badge[data-theme="dark"] {
  background: var(--bg-dark);
  color: var(--text-dark);
  border-color: rgba(255,255,255,0.1);
  
  & .license-icon {
    filter: invert(1) hue-rotate(180deg);
  }
}

/* 悬停效果 */
.license-badge:hover {
  transform: translateY(-1px);
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  
  &[data-theme="dark"]:hover {
    box-shadow: 0 2px 8px rgba(255,255,255,0.1);
  }
}
```

最后，在`archetypes/default.md`中添加以下代码段即可实现一个自动添加的开源协议呈现模组。
```md 
license: "CC-BY-NC-4.0"  # 你对应使用的协议

```

呈现效果如下：

![](/blog_images/CC-BY-NC-4.png)

> 但是，由于我对于前端不是很了解，黑夜模式下的样式调整未能正确实现，待解决。


## 修改时间

原本主题并没有显示「修改时间」的功能，我在这里参考了[Hugo PaperMod 主题精装修](https://yunpengtai.top/posts/hugo-journey/#%e6%b7%bb%e5%8a%a0%e4%bf%ae%e6%94%b9%e6%97%b6%e9%97%b4)。

在`layouts/partials/post_meta.html`中添加以下内容，参考的博客中`$scratch.Add`错误被包裹在`()`中，并且行末还有一个多余的`$`，我在此做了修改：
```html 
{{- if (.Param "ShowLastMod") -}}
    {{- if ne (.Lastmod.Format "2006-01-02") (.Date.Format "2006-01-02") -}}
        {{- $scratch.Add "meta" (slice (printf "Updated:&nbsp;%s" (.Lastmod.Format (.Site.Params.dateFormat | default "January 2, 2006")))) -}}
    {{- end -}}
{{- end -}}
```
并且，在`hugo.yaml`中加入：
```yaml 
params:
  showLastMod: true
```

同时，我们在`archetypes/default.md`中的配置如下：
```md 
---
title: "{{ replace .Name "-" " " | title }}"
date: {{ .Date }}
lastmod: {{ .Date }}
---
```
等我过几天看看这个效果咋样。

## MarginNote 

> 在这里十分感谢[Yunpeng Tai](https://yunpengtai.top/)的博客，我从上面学习和摘选了很多内容在本文中。


我们在`assets/extended/custom.css`：
```css 
.sidenote {
  float: right;
  position: relative;
  margin-right: -18vw;
  width: 40%;
  max-width: 200px;
}
body {
  counter-reset: sidenote-counter;
}
.sidenote-number {
  counter-increment: sidenote-counter;
}
.sidenote::before {
  content: "# ";
  position: relative;
  font-size: 0.9em;
  font-weight: 700;
  color: red;
}
.sidenote-number::after {
  content: "#";
  vertical-align: super;
  font-size: 0.8em;
  font-weight: 700;
  color: #409dff;
}
.sidenote-number:hover .sidenote {
  background-color: var(--sidenote-bg);
}

```

同时，在`layouts/shortcodes/sidenote.html`中添加以下内容：
```html 
<span class="sidenote-number"><small class="sidenote">{{ .Inner | markdownify }}</small></span>

```

这是示例 {{< sidenote >}} 这是示例的侧边注解 {{< /sidenote >}}


## 盘古之白

> [「盤古之白」](https://blog.xiaoquankong.ai/zh/posts/chinese-document-typesetting-specification-spacing-of-pangu/)一文中讨论到，所有的中文字和半形的英文、數字、符號之間应该存在的空白，被漢學家稱為「盤古之白」，因為它劈開了全形字和半形字之間的混沌。

我们需要在`layouts/partials/extend_footer.html`中加入：
```html 
{{- $highlight := resources.Get "js/pangu.min.js" -}}
<script>
  (function (u, c) {
    var d = document,
      t = "script",
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (c) {
      o.addEventListener("load", function (e) {
        c(e);
      });
    }
    s.parentNode.insertBefore(o, s);
  })("{{ $highlight.RelPermalink }}", function () {
    pangu.spacingPage();
  });
</script>
```

同时，需要创建`assets/js/pangu.min.js`，网站加载时，盘古之白自动加载，大家可以从此处下载。


## Blockquote

> 参考于：[Hugo PaperMod 主题精装修](https://yunpengtai.top/posts/hugo-journey/#blockquote)

{{< quote >}}
为什么要演奏春日影！
{{< /quote >}}

在 `layouts/shortcodes/quote.html` 加入以下内容：
{{< collapse summary="layouts/shortcodes/quote.html" >}}
```html
<blockquote class="quote{{ range .Params }} {{ . }}{{ end }}">
    {{- $content := .Inner | markdownify -}}
    {{- if not (strings.HasPrefix $content "<p>") -}}
        {{ printf "<p>%s</p>" $content | safeHTML }}
    {{- else -}}
        {{ $content }}
    {{- end -}}
</blockquote>
```
{{< /collapse >}}

我们在`assets/css/extended/quote.css`中加入以下内容：

{{< collapse summary="assets/css/extended/quote.css" >}}
```css 
blockquote.quote {
  position: relative;
  margin: 1em auto;
  padding-left: 3em;
  border: none;
}

blockquote.quote::before {
  position: absolute;
  left: 0;
  content: "“";
  font-size: 3em;
  font-weight: bold;
  line-height: 1;
}

blockquote.quote-copyright {
  position: relative;
  margin: 2em auto;
  padding-left: 3em;
  border: none;
  background-color: aliceblue;
}

blockquote.quote-copyright::before {
  position: absolute;
  left: 0;
  content: "“";
  font-size: 3em;
  font-weight: bold;
  line-height: 1;
}

```
{{< /collapse >}}

